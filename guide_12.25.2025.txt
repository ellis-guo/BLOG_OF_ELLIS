================================================================================
PROJECT STATUS & CONTEXT FOR NEW CLAUDE SESSIONS
Last Updated: December 27, 2025
================================================================================

IMPORTANT: This file helps new Claude sessions understand the project quickly.
Read this FIRST before helping with any tasks.

================================================================================
PROJECT OVERVIEW
================================================================================

Personal Blog Website
- Tech Stack: Next.js 15.5.9 + TypeScript + Prisma + PostgreSQL + Clerk Auth
- Design Style: Academic minimalist (inspired by jzliu.net)
- Languages: Chinese / English / French (i18n routing)
- Color Scheme: Black text + #F35029 orange accent
- Typography: Rubik (body), Libre Baskerville (headings)

Creator: Ellis Guo (ÈÉ≠‰∏ñË∂ä)
Admin username: "admin"
Development Philosophy: "Build first, refine later" - step by step approach

================================================================================
COMPLETED FEATURES (Phases 1-9)
================================================================================

Phase 1-6: Core Architecture & Pages - DONE

Basic Structure:
- Next.js 15.5.9 project with App Router
- Three-layer layout: root ‚Üí [locale] ‚Üí (dashboard)
- Clerk authentication integrated
- Prisma + PostgreSQL database (Docker local development)
- Middleware for i18n routing with browser language detection
- Markdown rendering: react-markdown + remark-gfm
- Markdown editing: react-simplemde-editor + easymde

Database Models (schema.prisma):

1. Profile - Personal information
   Fields: bioZh, bioEn, bioFr (Text)
          email, github, linkedin, twitter, wechat (nullable)
          photoUrl (nullable)

2. LifeMoment - Photo gallery
   Fields: imageUrl (required)
          caption, intro (nullable)
          time (DateTime)
          order (Int for sorting)

3. Article - Blog posts and projects
   Fields: type (String: "project" or "post")
          slug (String, unique)
          titleZh, titleEn, titleFr (String)
          descriptionZh, descriptionEn, descriptionFr (Text, nullable)
          contentZh, contentEn, contentFr (Text, Markdown format)
          author (String, default: "Ellis Guo (ÈÉ≠‰∏ñË∂ä)")
          coverImage (String, nullable)
          visibility (Enum: public / guest / draft)
          createdAt, updatedAt (DateTime)

Pages Implemented:

- About Page (/[locale]/about) - Server-side rendered
  Features: 3D photo card with Comet effect
           Three-language bio display
           Contact information with platform labels
           Life Moments slider (Aceternity UI AnimatedTestimonials)
           Admin buttons (only visible to admin users)

- Article Detail Page (/[locale]/articles/[slug]) - Server-side rendered
  Features: Markdown content rendering with react-markdown
           Three-language support
           Type-based back button (‚Üê Back to Projects / ‚Üê Back to Posts)
           Formatted publish/update dates by locale
           Author display
           Custom .markdown-content CSS styling

- Navbar - Academic minimalist style
  Features: Animated signature logo (ÈÉ≠‰∏ñË∂ä Ellis Guo)
           Language switcher dropdown
           Clerk UserButton integration
           Responsive design

Components:
- AnimatedSignatureLogo - Handwritten signature with slide-in animation
- LanguageSwitcher - Language selection dropdown
- CometCard - 3D tilt effect for photos
- LifeMomentsSlider - Photo carousel with admin manage button
- ArticleItem - Article card component with admin edit button
- Footer - Simple copyright info

================================================================================
PHASE 7: ADMIN FEATURES - Profile & Moments (COMPLETED)
================================================================================

1. Edit Profile Feature
   Route: /[locale]/admin/profile/edit
   Functionality: Edit bio (3 languages), contact info, photo URL
   Technical: API /api/profile (GET/PUT), Client component with useState

2. Edit Moments Feature
   Route: /[locale]/admin/moments/edit
   Functionality: Add/delete Life Moments (no edit/reorder yet)
   Technical: API /api/moments (GET/POST/DELETE), Card grid + form

================================================================================
PHASE 8: ARTICLES SYSTEM (COMPLETED - December 24, 2025)
================================================================================

Complete CRUD system for blog posts and projects using a unified Article model.

1. API Routes - /api/articles

   GET: Fetch all articles or single article by ID
   - /api/articles ‚Üí returns all articles (ordered by createdAt desc)
   - /api/articles?id=xxx ‚Üí returns single article
   
   POST: Create new article (admin only)
   - Validates required fields: slug, titleZh/En/Fr
   - Checks for duplicate slug
   - Sets default values for optional fields
   
   PUT: Update article (admin only)
   - Requires article ID
   - Updates all provided fields
   - Preserves existing values if not provided
   
   DELETE: Remove article (admin only)
   - Requires article ID via query param

2. Admin Articles List Page - /[locale]/admin/articles

   Features:
   - Table display with columns: Title, Type, Author, Created, Status, Actions
   - Type badges: blue for "project", purple for "posts"
   - Visibility badges: green for "public", blue for "guest", gray for "draft"
   - Edit button (links to /admin/articles/[id]/edit)
   - Delete button (with confirmation dialog)
   - "New Article" button (orange, top-right)
   - Empty state message when no articles exist
   
   Technical:
   - Client component using useState + useEffect
   - Fetches articles via /api/articles on mount
   - Real-time list refresh after delete

3. New Article Page - /[locale]/admin/articles/new

   Form Sections:
   
   a) Basic Information
      - Slug (required, URL path preview)
      - Type (dropdown: Posts/Projects)
      - Author (pre-filled with "ÈÉ≠‰∏ñË∂ä Ellis Guo")
      - Visibility (dropdown: Public/Guest Only/Draft)
      - Cover Image URL (optional)
   
   b) Titles (3 Languages, all required)
      - Chinese Title (‰∏≠ÊñáÊ†áÈ¢ò)
      - English Title
      - French Title (Titre fran√ßais)
   
   c) Descriptions (3 Languages, optional)
      - Chinese Description (‰∏≠ÊñáÁÆÄ‰ªã)
      - English Description
      - French Description (Description fran√ßaise)
      - Hint text: "Leave empty to auto-generate from content"
   
   d) Content (3 Languages, Markdown)
      - SimpleMDE editor for each language
      - Toolbar: bold, italic, heading, quote, lists, link, image, guide
      - Memoized options to prevent re-initialization bug
   
   Technical:
   - Client component with useState for all fields
   - SimpleMDE imported dynamically (ssr: false)
   - useMemo for editor options to fix space key bug
   - Success message + auto-redirect after creation

4. Edit Article Page - /[locale]/admin/articles/[id]/edit

   Same form structure as New page, plus:
   - Preview button (opens article in new tab)
   - Pre-populated with existing data via useEffect
   - Loading state while fetching article
   - Update button instead of Create button
   
   Technical:
   - Fetches article via /api/articles?id=xxx on mount
   - Same SimpleMDE configuration as New page
   - PUT request to update article

5. Public Article Detail Page - /[locale]/articles/[slug]

   Layout (from top to bottom):
   - Back button (‚Üê Back to Projects / ‚Üê Back to Posts based on type)
   - Article title (from titleZh/En/Fr based on locale)
   - Metadata section:
     * üìÖ Published: [formatted date]
     * üîÑ Updated: [formatted date]
     * ‚úçÔ∏è Author: [author name]
   - Markdown content (rendered with react-markdown + remark-gfm)
   
   Technical:
   - Server component with direct Prisma query
   - Returns 404 if article not found
   - Date formatting based on locale (zh-CN, en-US, fr-FR)
   - Custom .markdown-content CSS class applied

6. Markdown Styling - globals.css

   Added .markdown-content class with styling for:
   - Headings (h1-h6): Libre Baskerville font, black color
   - H1: 28px with bottom border
   - H2: 22px with subtle bottom border
   - Paragraphs: 1.2em bottom margin
   - Links: black with underline, hover #F35029
   - Lists: 2em left padding
   - Code blocks: gray background, orange left border, monospace font
   - Inline code: light gray background, rounded corners
   - Blockquotes: orange left border, italic, gray text
   - Images: max-width 100%, rounded corners, shadow
   - Tables: bordered with hover effect
   - Horizontal rules: 2px gray border

================================================================================
PHASE 9: PROJECTS AND POSTS LIST PAGES (COMPLETED - December 27, 2025)
================================================================================

Public-facing list pages with role-based access control for browsing articles.

1. Visibility Enum Migration

   Changed visibility field from String to Enum in schema:
   
   enum Visibility {
     public  // All users can see
     guest   // Logged-in users (guest + admin)
     draft   // Admin only
   }
   
   Migration completed: npx prisma migrate dev

2. Projects List Page - /[locale]/projects

   Features:
   - Server Component with direct Prisma query
   - Role-based filtering:
     * Admin: sees all projects (including drafts)
     * Guest (logged-in): sees public + guest projects
     * Visitor (not logged-in): sees public projects only
   - Uses ArticleItem component for display
   - Three-language support (title, description, date)
   - Auto-generates description from content if not provided (150 chars)
   - Empty state with localized messages
   
   Technical:
   - Queries: prisma.article.findMany({ where: { type: "project", visibility: ... } })
   - Uses Visibility enum from @prisma/client
   - Date formatting by locale (zh-CN, en-US, fr-FR)
   - Helper functions for title/description/date extraction

3. Posts List Page - /[locale]/posts

   Features:
   - Identical structure to Projects page
   - Filters by type: "post" instead of "project"
   - Same role-based access control
   - Same display logic and components
   
   Note: URL is /posts (not /blog), but Navbar still displays "ÈöèÁ¨î/Posts/Billets"

4. ArticleItem Component Enhancement

   New features:
   - Admin-only Edit button (appears on hover)
   - Positioned at top-right of article card
   - Links to /admin/articles/[id]/edit
   - Converted to Client Component for onClick handler
   
   New props:
   - id: string (article ID for edit link)
   - isAdmin: boolean (show/hide edit button)
   - locale: string (for edit link path)
   
   Technical:
   - Added "use client" directive
   - Uses CSS opacity transition for hover effect (opacity-0 ‚Üí opacity-100)
   - onClick stopPropagation to prevent card link trigger
   - Positioned absolute with z-10 to stay on top

5. Navigation Updates

   Changed:
   - Navbar: /blog link ‚Üí /posts link
   - Article detail page: back button for posts ‚Üí /posts (was /)
   
   Kept:
   - Navbar display text: "ÈöèÁ¨î/Posts/Billets" (unchanged)
   - Admin pages: Type dropdown shows "Posts (Blog)" and "Projects"

6. Admin Pages Updates

   Visibility dropdown now has 3 options:
   - Public (ÊâÄÊúâ‰∫∫ÂèØËßÅ)
   - Guest Only (ÁôªÂΩïÁî®Êà∑ÂèØËßÅ)
   - Draft (‰ªÖÁÆ°ÁêÜÂëòÂèØËßÅ)
   
   Files updated:
   - /admin/articles/new/page.tsx
   - /admin/articles/[id]/edit/page.tsx
   - /admin/articles/page.tsx (badge display)

================================================================================
CRITICAL TECHNICAL PATTERNS
================================================================================

SimpleMDE Editor Bug Fix

CRITICAL: SimpleMDE options MUST be memoized to prevent re-initialization bug.

Without memoization:
- Typing space key causes cursor to jump
- Editor loses focus
- Editing becomes impossible

Correct implementation:
```tsx
const editorOptions = useMemo(
  () => ({
    spellChecker: false,
    status: false,
    toolbar: [...] as const,  // 'as const' is required for TypeScript
  }),
  []
);

<SimpleMDE value={content} onChange={setContent} options={editorOptions} />
```

Why this works:
- useMemo prevents options object from being recreated on every render
- Without it, SimpleMDE thinks it's a new instance and re-initializes
- 'as const' satisfies TypeScript's strict toolbar type requirements

---

SimpleMDE Rendering Behavior

SimpleMDE/EasyMDE is a WYSIWYG-style Markdown editor by design:
- **Bold** text appears bold while editing
- Headings appear larger while editing
- But saves as plain Markdown code (**, ##, etc.)

This is INTENTIONAL, not a bug. It's the editor's core feature.
Cannot be disabled - it's how CodeMirror (the underlying library) works.

If Ellis wants raw Markdown display, use <textarea> instead.

---

Article Model Design Philosophy

All content is stored in the Article model:
- "Article" is the umbrella term for all content
- type field distinguishes: "project" or "post"
- NOT "Post model with project/article types"
- Unified structure: same fields for both types

Why:
- Simpler database design
- Shared editing interface
- Easy to query: findMany({ where: { type: "project" } })

---

Description Fields (Optional but Important)

descriptionZh/En/Fr are OPTIONAL fields for article summaries.

Purpose:
- Display in article list pages (Projects / Posts)
- Better than auto-truncating content
- SEO-friendly (meta descriptions)

Fallback strategy (implemented in list pages):
- If description exists ‚Üí use description
- If empty ‚Üí auto-generate from first 150 chars of content

---

Frontend vs Backend Data Fetching

Article Detail Page (Public):
- Server component: export default async function ArticlePage()
- Direct database access: await prisma.article.findUnique({ where: { slug } })
- Fast, SEO-friendly
- No API calls needed

Admin Pages (Interactive):
- Client component: "use client" + useState + useEffect
- API calls: fetch('/api/articles')
- Real-time updates and form interactions

---

Middleware Critical Note

File: middleware.ts

MUST skip locale handling for API routes:
```tsx
if (pathname.startsWith("/api/")) {
  return NextResponse.next();
}
```

Why: Without this, /api/articles becomes /en/api/articles (404)

---

Visibility Enum Usage

After migrating to Enum type, always import and use enum values:
```typescript
import { Visibility } from "@prisma/client";

// Correct usage
whereClause = {
  type: "project",
  visibility: Visibility.public  // Single value
};

whereClause = {
  type: "post", 
  visibility: { in: [Visibility.public, Visibility.guest] }  // Multiple values
};

// Wrong usage (will cause TypeScript error)
visibility: "public"  // ‚ùå Don't use string
visibility: { in: ["public", "guest"] }  // ‚ùå Don't use string array
```

Type declaration for whereClause:
```typescript
let whereClause: {
  type: string;
  visibility?:
    | Visibility
    | {
        in: Visibility[];
      };
};
```

Why:
- Type safety: prevents typos like "pubic" or "darft"
- Database validation: Prisma rejects invalid values
- Better autocomplete in IDE

---

Server vs Client Component for Lists

Projects/Posts pages architecture:
- List page: Server Component (no "use client")
  * Can use currentUser() from @clerk/nextjs/server
  * Can query database directly with Prisma
  * Determines user role and prepares data
  
- ArticleItem: Client Component ("use client")
  * Receives data as props from Server Component
  * Has interactive elements (hover, onClick)
  * Cannot use currentUser() or Prisma

Common mistake:
- Adding "use client" to list page ‚Üí breaks currentUser()
- Forgetting "use client" on ArticleItem ‚Üí breaks onClick

Rule: Keep data fetching in Server Components, interaction in Client Components

================================================================================
PENDING FEATURES (NOT STARTED)
================================================================================

High Priority:
- Image upload integration for SimpleMDE
  * Direct upload to Cloudinary from editor
  * Auto-insert image URL into Markdown
  * Show upload progress and handle errors

Medium Priority:
- Edit existing Life Moments (currently only add/delete)
- Reorder Life Moments (drag-to-reorder or manual order field)
- Homepage design (currently just welcome message)
  * Maybe featured projects/posts?
  * Latest updates?

Low Priority:
- Search functionality
- Dark mode
- Comments system
- RSS feed

On Hold (Performance & Security - before deployment):
- Docker connection pool optimization
- Image optimization (Next.js Image component)
- Font loading optimization (next/font)
- npm audit security fixes
- Accessibility improvements

================================================================================
DEVELOPMENT GUIDELINES
================================================================================

Ellis's Preferences (MUST FOLLOW)

1. Communication Style:
   - Explain logic and reasoning BEFORE giving code
   - Wait for confirmation: "ÂèØ‰ª•ÂÜô‰ª£Á†Å‰∫Ü", "ÂÜôÂêß", "ÁªßÁª≠"
   - Use life analogies to explain technical concepts
   - Keep responses conversational, not overly technical
   - Read COLLABORATION_RULES.txt for detailed guidelines

2. Coding Approach:
   - "Build first, refine later" - get it working first
   - Simple solutions over complex ones
   - ÊØè‰∏™‰∏úË•ø‰∏ÄÊ≠•Ê≠•ÂÅö,Êàë‰∏çËØ¥‰Ω†‰∏çÂÅö
   - Comments in English always
   - Prefer explicit code over "clever" solutions

3. Commit Messages:
   - Professional English style (not conversational mix)
   - Concise and clear
   - Ellis complained when commits are too long - keep it SHORT
   - Use numbered list format (1. 2. 3. 4.)

4. Learning Style:
   - Ellis wants to understand "why" not just "how"
   - Ask clarifying questions when requirements are vague
   - Provide options with pros/cons, let Ellis decide
   - Never assume requirements or features

Git Commit Example (Ellis's actual style):
feat: implement articles management system

Add Article model with author, coverImage, description fields
Create /api/articles CRUD endpoints
Add admin pages: list, new, edit with SimpleMDE editor
Add public article detail page with markdown rendering

Tested and working.

================================================================================
COMMON ISSUES & SOLUTIONS
================================================================================

Issue: SimpleMDE cursor jumps on space key
Cause: Options object not memoized, causes re-initialization
Solution: Use useMemo(() => ({ ...options }), []) with 'as const' for toolbar

Issue: SimpleMDE auto-renders Markdown while editing
Cause: This is intentional WYSIWYG behavior, cannot be disabled
Solution: Accept it (it's a feature) or switch to <textarea>

Issue: Next.js + Clerk compatibility errors
Cause: Version mismatches between Next.js and Clerk
Solution: Use Next.js 15.5.9 (not 16.x) with @clerk/nextjs@6.32.2
         Install with --legacy-peer-deps if needed

Issue: Markdown content appears as one long paragraph
Cause: Line breaks lost during copy-paste
Solution: Use seed script or ensure proper \n\n between paragraphs

Issue: API Returns 404
Cause: Middleware redirects API routes
Solution: Add API path check in middleware (already fixed)

Issue: About page loads slowly
Note: This is due to Docker network overhead (local development)
      Will be addressed during pre-deployment optimization phase

Issue: "Event handlers cannot be passed to Client Component props"
Cause: Component with onClick is Server Component, not Client Component
Solution: Add "use client" to component file (e.g., ArticleItem)
Note: Error message is misleading - it means the component NEEDS to be Client Component

Issue: "server-only cannot be imported from Client Component"
Cause: Accidentally added "use client" to Server Component that uses Prisma/currentUser
Solution: Remove "use client" from pages that fetch data (Projects, Posts, etc.)
Check: Only interactive components (ArticleItem, forms) should be Client Components

================================================================================
FILE STRUCTURE QUICK REFERENCE
================================================================================

Key Files:
- middleware.ts - Language routing + API path handling
- prisma/schema.prisma - Database schema (Profile, LifeMoment, Article)

API Routes:
- src/app/api/profile/route.ts - Profile CRUD
- src/app/api/moments/route.ts - Life Moments CRUD
- src/app/api/articles/route.ts - Articles CRUD

Public Pages:
- src/app/[locale]/(dashboard)/about/page.tsx - About display
- src/app/[locale]/(dashboard)/projects/page.tsx - Projects list
- src/app/[locale]/(dashboard)/posts/page.tsx - Posts list
- src/app/[locale]/(dashboard)/articles/[slug]/page.tsx - Article detail

Admin Pages:
- src/app/[locale]/admin/profile/edit/page.tsx - Profile editor
- src/app/[locale]/admin/moments/edit/page.tsx - Moments manager
- src/app/[locale]/admin/articles/page.tsx - Articles list
- src/app/[locale]/admin/articles/new/page.tsx - Create article
- src/app/[locale]/admin/articles/[id]/edit/page.tsx - Edit article

Components:
- src/components/ArticleItem.tsx - Article card with admin edit button
- src/components/LifeMomentsSlider.tsx - Photo carousel
- src/components/Navbar.tsx - Navigation bar
- src/components/Footer.tsx - Footer
- src/components/AnimatedSignatureLogo.tsx - Animated logo
- src/components/LanguageSwitcher.tsx - Language dropdown
- src/components/ui/comet-card.tsx - 3D effect wrapper
- src/components/ui/animated-testimonials.tsx - Carousel component

Styles:
- src/app/globals.css - Global styles + .markdown-content class

i18n:
- src/i18n/i18n.ts - i18n configuration
- src/i18n/locales/zh.json - Chinese translations
- src/i18n/locales/en.json - English translations
- src/i18n/locales/fr.json - French translations

Config:
- src/config/site.ts - Site metadata
- src/lib/prisma.ts - Prisma client singleton
- src/lib/settings.ts - Admin username constants

================================================================================
NEXT STEPS (Immediate Priority)
================================================================================

1. Image Upload Integration - SimpleMDE Editor
   - Integrate Cloudinary upload in SimpleMDE
   - Direct upload from markdown editor
   - Auto-insert uploaded image URL into content
   - Show upload progress, handle errors
   
2. Life Moments Management Enhancement
   - Edit existing moments (currently only add/delete)
   - Reorder moments (drag-to-reorder or manual order field)
   
3. Homepage Design
   - Currently just welcome message
   - Need to design a proper landing page
   - Maybe featured projects/posts?

Implementation Notes:
- SimpleMDE has plugin system for custom buttons
- Cloudinary SDK can handle browser uploads
- Consider UX: show upload progress, handle errors gracefully

================================================================================
DEFERRED OPTIMIZATIONS (Before Deployment)
================================================================================

Performance:
- Database connection pooling for Docker
- Next.js Image component for all images
- Font optimization (next/font)
- Static generation for article pages

Security:
- npm audit fix (currently has 0 vulnerabilities after Next.js 15.5.9 update)
- Environment variable validation
- Input sanitization review

Features:
- Image upload integration (Cloudinary SDK in SimpleMDE)
- Edit/reorder Life Moments
- Markdown editor improvements (if needed)

Accessibility:
- ARIA labels
- Keyboard navigation
- Screen reader support
- Color contrast validation

================================================================================
IMPORTANT NOTES FOR NEW SESSIONS
================================================================================

1. Ellis's Working Style:
   - Prefers understanding over speed
   - Values step-by-step confirmation
   - Asks "why" frequently - always explain reasoning
   - Commits in professional English (concise!)
   - Comments in code must be English

2. Project Philosophy:
   - "Build first, refine later"
   - Simple solutions preferred
   - Don't add features unless explicitly requested
   - Performance/security optimization deferred to pre-launch

3. Communication:
   - Read COLLABORATION_RULES.txt for detailed guidelines
   - Wait for confirmation before providing code
   - Use analogies to explain concepts
   - Never assume requirements
   - Keep commit messages SHORT

4. Technical Constraints:
   - Docker PostgreSQL (local dev, may be slow)
   - Next.js 15.5.9 (locked, don't upgrade to 16.x)
   - Clerk auth (username "admin" for admin access)
   - No localStorage/sessionStorage in artifacts

================================================================================
WHEN STARTING A NEW SESSION
================================================================================

1. Read this file completely
2. Read COLLABORATION_RULES.txt for communication style
3. Check recent git commits to see latest changes
4. Ask Ellis what they want to work on
5. Explain approach before writing code
6. Remember: Teacher mindset, not code generator

================================================================================
SUCCESS METRICS
================================================================================

You're doing well if Ellis says:
- "ÊàëÊòéÁôΩ‰∫Ü!" (I understand!)
- "ÂéüÊù•ÊòØËøôÊ†∑!" (That's how it works!)
- "ÂÅöÂæóÁúüÂ•Ω" (Well done!)
- "ÁªßÁª≠Âêß" (Continue)

You need to adjust if Ellis says:
- "‰∏çÊáÇ" (Don't understand)
- "Â§™Â§çÊùÇ" (Too complicated)
- "ÂÅáËÆæ‰∫Ü" (You assumed something)

================================================================================
END OF PROJECT STATUS
================================================================================